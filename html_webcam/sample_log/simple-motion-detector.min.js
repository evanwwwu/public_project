function SimpleMotionDetector(a){var b=200,c=150,d=window.innerHeight,e=4*d/3;this.amplificationAlpha=3,this.amplificationGamma=3,this.offsetAlpha=15,this.offsetGamma=0,this.fillcolor="#f00",this.detectionBorder=1,this.pixelThreshold=1,this.averageX=new MovingAverager(1e3),this.averageX.setValue(e/2),this.averageY=new MovingAverager(1e3),this.averageY.setValue(d/2);var f=document.createElement("canvas");f.width=b,f.height=c,f.id="videooo",document.getElementById(a).appendChild(f);var g=document.createElement("canvas");g.width=e,g.height=d,g.style.position="relative",g.style.left="0px",g.style.top="0px",document.getElementById(a).appendChild(g);var j,m,h=f.getContext("2d"),i={},k=null,l=g.getContext("2d"),n=[],o={name:"red",x:10,y:10,w:.1*e,h:.1*e,value:"#f00"};n.push(o);var p={name:"green",x:10,y:10+(.1*e+20),w:.1*e,h:.1*e,value:"#0f0"};n.push(p);var q={name:"blue",x:10,y:10+2*(.1*e+20),w:.1*e,h:.1*e,value:"#00f"};n.push(q),SimpleMotionDetector.prototype.init=function(){j=this,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,m=document.createElement("video"),navigator.getUserMedia?navigator.getUserMedia({audio:!1,video:!0},function(a){m.src=window.URL.createObjectURL(a),i.videoWidth=b,i.videoHeight=c,i.frontCanvas=document.createElement("canvas"),i.frontCanvas.width=i.videoWidth,i.frontCanvas.height=2*i.videoHeight,i.ctx=i.frontCanvas.getContext("2d"),i.comp=[],j.run()},function(a){alert("getUserMedia did not succeed.\n\ncode="+a.code)}):alert("Your browser does not seem to support UserMedia"),requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}()},SimpleMotionDetector.prototype.analyisMotionPicture=function(){h.drawImage(g,0,0);var a=h.getImageData(0,0,b,c).data;l.fillStyle="#FFFFFF",l.fillRect(0,0,e,d),l.globalAlpha=1;for(var f=e/b-1|0,i=d/c-1|0,j=b/e,k=c/d,m=Number.MAX_VALUE,o=0;o<n.length;o++){l.fillStyle=n[o].value,l.fillRect(n[o].x,n[o].y,n[o].w,n[o].h);for(var p=h.getImageData(n[o].x*j,n[o].y*k,n[o].w*j,n[o].h*k).data,q=0,r=0,s=.25*p.length;s>q;)r+=p[4*q]+p[4*q+1]+p[4*q+2],++q;var t=Math.round(r/(3*s));t>50&&(this.fillcolor=n[o].value,console.log("Button "+n[o].name+" triggered."))}for(var u=0;c>u;u++)for(var v=0;b>v;v++)if(a[4*v+u*b*4]>this.pixelThreshold){var w=v*e/b,x=u*d/c;m>=Math.min(m,x)&&(m=x,this.averageX.setValue(w),this.averageY.setValue(x),l.fillStyle="#000000",l.fillRect(w,x,f,i)),l.fillStyle=this.fillcolor,l.fillRect(w,x,f,i)}},SimpleMotionDetector.prototype.updateCameraPosition=function(){var a=this.averageX.getValue()*b/e-b/2,f=this.amplificationAlpha*Math.asin(a/b)+Math.PI/180*this.offsetAlpha,g=c/2-this.averageY.getValue()/d*c,h=this.amplificationGamma*Math.asin(g/c)+Math.PI/180*this.offsetGamma,i=camera.position.x,j=camera.position.z,k=camera.position.y,l=Math.sqrt(i*i+k*k+j*j);camera.position.x=l*Math.sin(f)*Math.cos(h),camera.position.z=l*Math.cos(f)*Math.cos(h),camera.position.y=l*Math.sin(h),camera.lookAt(scene.position)},SimpleMotionDetector.prototype.analyseVideo=function(){requestAnimFrame(SimpleMotionDetector.prototype.analyseVideo),h.drawImage(m,0,0,b,c),i.ctx.drawImage(f,0,0),k.loadContentsOf(i.frontCanvas),g.draw(k),g.mirror(),g.move(),g.update(),i.ctx.drawImage(f,0,c),j.analyisMotionPicture()},SimpleMotionDetector.prototype.run=function(){g=fx.canvas(),k=g.texture(i.frontCanvas),m.play(),this.analyseVideo()},SimpleMotionDetector.prototype.domElement=g}