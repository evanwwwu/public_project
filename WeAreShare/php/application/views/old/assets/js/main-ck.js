var $body=window.opera?document.compatMode=="CSS1Compat"?$("html"):$("body"):$("html,body"),site={init:function(){site.mainNavEffect();site.naviFixed();site.goTop();site.showAD();site.accordionMenu();site.fbMenu();site.relatedTab();site.popupForm();site.footer()},loginStep:function(){$("#register .register a").click(function(){$("#register").hide();$("#logIn").fadeIn()});$("#register a.submitBtn").click(function(){var e=$("#register .email").val();if(e===""){alert("請輸入電子信箱");$("#register .register input").focus();return!1}var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(t.test(e)!=1){alert("電子信箱格式錯誤");$("#register .register input").focus();$("#register .register input").select();return!1}$("#register").hide();$("#profile").fadeIn()});$("#profile .submitBtn").click(function(){$("#profile").hide();$("#registerSuccess").fadeIn()})},indexOnLoad:function(){var e,t=$(window).width();$(window).resize(function(){var t=$(window).width();t<640?e=!0:e=!1});t<640?e=!0:e=!1;e||$("body").hasClass("index")&&$(".marginAnimate").animate({height:"450px"},700,"easeInOutCirc").delay(1500).animate({height:"0px"},700,"easeInOutCirc")},mainNavEffect:function(){var e=$(window).width();e>640&&$("#mainNav > ul > li > a").hover(function(){$(this).parent("li").hasClass("active")||$("#mainNav li.active > a").css({backgroundColor:"#ed1c24",color:"#fff"})},function(){$("#mainNav li.active > a").removeAttr("style")})},slideBanner:function(){var e=$(".swipe-wrap > div").length,t=$("#slidePos");for(i=0;i<e;i++)t.append("<li><a href='#' onclick='mySwipe.slide("+i+",500); return false;'></a></li>");$("#slidePos li:first-child").addClass("active");var n=document.getElementById("slideBanner");window.mySwipe=Swipe(n,{auto:4e3,continuous:!0,speed:700,callback:function(e){var t=r.length;while(t--)r[t].className=" ";r[e].className="active"}});var r=document.getElementById("slidePos").getElementsByTagName("li");$(".wordW a").click(function(){mySwipe.prev();return!1});$(".wordE a").click(function(){mySwipe.next();return!1})},showAD:function(){function e(){$(".marginAnimate").animate({height:"450px"},700,"easeInOutCirc",function(){$(".marginAnimate a").css("height","450")});$(".adCloseBtn").fadeIn();t()}function t(){$(".adCloseBtn").click(function(){$(".openToggle").show();$(".marginAnimate").animate({height:"0"},700,"easeInOutCirc",function(){$(".marginAnimate a").css("height","0")});$(this).fadeOut(700);return!1})}$(".openToggle").hover(function(){$(this).children("a").css("display","block")},function(){$(this).children("a").css("display","none")});$(".openToggle a").click(function(){var t=parseInt($(".marginAnimate").css("height"));if(t===0){e();$(".openToggle").hide()}})},accordionMenu:function(){$("#menu > ul > li").toggleClass("menu-header");$(".menu-header > a").click(function(){if($(this).next("ul").is(":visible")){$(this).next("ul").slideUp("slow");$(this).parent().removeClass("open")}else{$("#menu > ul > li > ul").slideUp();$(".menu-header").removeClass("open");$(this).parent().addClass("open");$(this).next("ul").slideToggle()}return!1})},naviFixed:function(){var e=$("body"),t=$(window).width(),n,r=$("#topNav"),i=$("#mainNav"),s=$(".innerWrapper");$(window).resize(function(){var e=$(window).width();e<640?n=!0:n=!1});t<640?n=!0:n=!1;$(window).scroll(function(){var t,o=r.offset().top+r.height()-27,u=s.offset().top-33,a=$(window).scrollTop();if(!n)$(window).scrollTop()>u?i.addClass("fixed"):i.removeClass("fixed");else{a>90&&r.addClass("small");!e.hasClass("menu-open")&&a<90&&!e.hasClass("log-open")&&a<90&&r.removeClass("small")}})},fbMenu:function(){function a(){var e=$(document).outerWidth(),t=$("#menu").outerHeight(),n=$("#menu .search").outerHeight(),r=$("#topNav"),i=$("#wrapper");$(".logMenu").hide();$(".fbMenu").show();$("#closeMask").show().css({width:e-210,left:"210px"});$("body").addClass("menu-open");$("#viewport").css("height",t);$("#wrapper").scrollTop(u);$("#wrapper").css({top:-u});$("#menu > ul").css("height",t-n)}function f(){var e=$("#topNav"),t=$("#wrapper");$("#closeMask").hide().css({left:"0",right:"none"});$("body").removeClass("menu-open");$("#viewport").css("height","auto");$("#wrapper").removeAttr("style");$(window).scrollTop(u);$(".fbMenu").hide();return!1}function l(){var e=$(document).outerWidth(),t=$("#menu").outerHeight(),n=$("#topNav"),r=$("#wrapper");$("#closeMask").show().css({width:e-210,right:"210px"});$("body").addClass("log-open");$(".logMenu").show();$(".fbMenu").hide();$("#viewport").css("height",t);$("#wrapper").scrollTop(u);$("#wrapper").css({top:-u});return!1}function c(){var e=$("#topNav"),t=$("#wrapper");$("#closeMask").hide().css({right:"0",left:"none"});$(".logMenu").hide();$("body").removeClass("log-open");$("#viewport").css("height","auto");$("#wrapper").removeAttr("style");$(window).scrollTop(u);return!1}var e=$("body"),t=$("#viewport"),n=$("#menu"),r=$("#closeMask"),i=$("#wrapper"),s=$(".trigger"),o=$(".logTrigger"),u;s.click(function(){u=$(window).scrollTop();e.hasClass("menu-open")?f():a();return!1});o.click(function(){u=$(window).scrollTop();e.hasClass("log-open")?c():l()});r.click(function(){event.preventDefault();e.hasClass("menu-open")?f():c()});$(window).resize(function(){var e=$(window).width();if($("body").hasClass("menu-open")){e>640&&$(".fbMenu").css("display","none");e<640&&$(".fbMenu").css("display","block")}})},changeFontSize:function(){$(".fontSizeCtl a").click(function(e){if($(this).hasClass("small")){$(".postContent p").each(function(){var e=parseInt($(this).css("font-size")),t=e-2,n=Math.ceil(t*1.5);$(this).css("font-size",t);$(this).css("line-height",n+"px")});$(".postContent span").each(function(){var e=parseInt($(this).css("font-size")),t=e-2,n=Math.ceil(t*1.5);$(this).css("font-size",t);$(this).css("line-height",n+"px")})}if($(this).hasClass("bigger")){$(".postContent p").each(function(){var e=parseInt($(this).css("font-size")),t=e+2,n=Math.ceil(t*1.5);$(this).css("font-size",t);$(this).css("line-height",n+"px")});$(".postContent span").each(function(){var e=parseInt($(this).css("font-size")),t=e+2,n=Math.ceil(t*1.5);$(this).css("font-size",t);$(this).css("line-height",n+"px")})}e.preventDefault();return!1})},popupForm:function(){$(".signIn").click(function(){var e=$(window).height();$("body").css({height:e,overflow:"hidden"});$("#register").fadeIn();$("#overlay").fadeIn()});$(".logIn").click(function(){var e=$(window).height();$("body").css({height:e,overflow:"hidden"});$("#logIn").fadeIn();$("#overlay").fadeIn()});$(".popupForm .closeBtn").click(function(){$(".popupForm").fadeOut();$("#overlay").fadeOut();$("body").css({height:"auto",overflow:"auto"})})},relatedTab:function(){$(".tab_content").hide();$(".tabs li:first").addClass("selected").show();$(".tab_content:first").show();$(".tabs li").click(function(){$(".tabs li").removeClass("selected");$(this).addClass("selected");$(".tab_content").hide();var e=$(this).find("a").attr("href");$(e).fadeIn();return!1})},isMobileMode:function(){var e=$(window).width();return e<640?!0:!1},isPhone:function(){return/iphone|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase())?!0:!1},goTop:function(){var e=window.opera?document.compatMode=="CSS1Compat"?$("html"):$("body"):$("html,body");$(".goTop a").click(function(){e.animate({scrollTop:0},700,"easeInOutCirc");return!1})},getRecommend:function(e){this.url=e;$.ajax({url:this.url,type:"GET",dataType:"json",success:function(e){if(site.isMobileMode())var t=4;else var t=3;var n=1,r=0,i,s=e.length,o=e.length/t;if(t<s)i=t;else{i=s;$("#pager").hide()}$("#pager .prevBtn").addClass("disable");for(var u=0;u<i;u++){$("#recommend ul").append('<li><a href="'+e[u].url+'"><img src="'+e[u].img+'"/><div class="date">'+e[u].date+"</div><p>"+e[u].title+"</p></a></li>");r+=1}$("#pager .nextBtn").bind("click",function(){$("#pager .prevBtn").removeClass("disable");if(r<s){n+=1;$("#recommend ul li").fadeOut().remove();if(s-r>t){var i=r+t;for(var o=r;o<i;o++)$("#recommend ul").append('<li style="display:none;"><a href="'+e[o].url+'"><img src="'+e[o].img+'"/><div class="date">'+e[o].date+"</div><p>"+e[o].title+"</p></a></li>");r=i}else{for(var o=r;o<s;o++)$("#recommend ul").append('<li style="display:none;"><a href="'+e[o].url+'"><img src="'+e[o].img+'"/><div class="date">'+e[o].date+"</div><p>"+e[o].title+"</p></a></li>");$(this).addClass("disable");r=s}$("#recommend ul li").fadeIn("slow")}return!1});$("#pager .prevBtn").bind("click",function(){$("#pager .nextBtn").removeClass("disable");if(n>1){r=(n-1)*t;n-=1;$("#recommend ul li").fadeOut().remove();for(var i=(n-1)*t;i<n*t;i++)$("#recommend ul").append('<li style="display:none;"><a href="'+e[i].url+'"><img src="'+e[i].img+'"/><div class="date">'+e[i].date+"</div><p>"+e[i].title+"</p></a></li>");$("#recommend ul li").fadeIn("slow");n===1&&$(this).addClass("disable")}return!1})},error:function(){$("#recommend ul").remove();$("#recommend").append("<p> no information </p>")}})},getFamous:function(e){this.url=e;$.ajax({url:this.url,type:"GET",dataType:"json",success:function(e){if(site.isMobileMode())var t=4;else var t=3;var n=1,r=0,i,s=e.length,o=e.length/t;if(t<s)i=t;else{i=s;$("#pager").hide()}$("#pager .prevBtn").addClass("disable");for(var u=0;u<i;u++){$("#famous ul").append('<li><a href="'+e[u].url+'"><img src="'+e[u].img+'"/><div class="date">'+e[u].date+"</div><p>"+e[u].title+"</p></a></li>");r+=1}$("#pager .nextBtn").bind("click",function(){$("#pager .prevBtn").removeClass("disable");if(r<s){n+=1;$("#famous ul li").fadeOut().remove();if(s-r>t){var i=r+t;for(var o=r;o<i;o++)$("#famous ul").append('<li style="display:none;"><a href="'+e[o].url+'"><img src="'+e[o].img+'"/><div class="date">'+e[o].date+"</div><p>"+e[o].title+"</p></a></li>");r=i}else{for(var o=r;o<s;o++)$("#famous ul").append('<li style="display:none;"><a href="'+e[o].url+'"><img src="'+e[o].img+'"/><div class="date">'+e[o].date+"</div><p>"+e[o].title+"</p></a></li>");$(this).addClass("disable");r=s}$("#famous ul li").fadeIn("slow")}return!1});$("#pager .prevBtn").bind("click",function(){$("#pager .nextBtn").removeClass("disable");if(n>1){r=(n-1)*t;n-=1;$("#famous ul li").fadeOut().remove();for(var i=(n-1)*t;i<n*t;i++)$("#famous ul").append('<li style="display:none;"><a href="'+e[i].url+'"><img src="'+e[i].img+'"/><div class="date">'+e[i].date+"</div><p>"+e[i].title+"</p></a></li>");$("#famous ul li").fadeIn("slow");n===1&&$(this).addClass("disable")}return!1})},error:function(){$("#famous ul").remove();$("#famous").append("<p> no information </p>")}})},magnificPop:function(){$("#related_gallery").magnificPopup({delegate:"a",type:"image"})},footer:function(){$("#footer").hasClass("indexfooter")&&setTimeout(function(){$("#footer").removeClass("footerOpen")},1500);$("#footer .openBtn").click(function(){if($("#footer").hasClass("footerOpen")){$(".view").hide();$("#footer").removeClass("footerOpen")}else{$(".view").show();$("#footer").addClass("footerOpen")}return!1})}};$(document).ready(function(){site.init()});